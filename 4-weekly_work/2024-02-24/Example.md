## 迁移学习的准备工作

### 读取小样本数据
1、增加了一个lsDataset的读取数据集方式
2、去除预处理
3、新建image1、loss.txt、test.
4、修改一下config文件
5、RGB通道口修改一下
6、循环的地方输出修改一下
7、跑的显卡从0卡换到1卡

您对深度学习的基本过程的理解是正确的：将输入（如图片）送入网络，网络会产生输出，然后将输出与真实值进行比较，通过计算损失值来评估网络的表现。根据损失值通过反向传播算法调整网络参数，以期改善网络的表现。

对于您提到的去云任务，如果您希望网络在一开始就能输出与原始含云图像相似的结果，并逐渐学习去除云层以接近无云的真实图像，您可以考虑以下几个策略：

1. 从含云图像作为初始基准开始
您可以将网络设计成在一开始就尽量保留输入图像的原始特征，然后逐渐地学习如何去除云层。这可以通过以下几种方法实现：

恒等损失（Identity Loss）：在损失函数中加入一个项，鼓励网络输出与输入图像在没有去云操作的情况下尽可能相似。这可以帮助网络在初期阶段保持对输入图像的忠实度，而后逐渐学习去云的特征。

残差学习（Residual Learning）：设计网络以学习输入图像与无云图像之间的残差（即云层部分）。网络的输出将是对云层的预测，然后从输入图像中减去这个预测来得到去云图像。这种方法自然地保留了输入图像的大部分内容，只专注于去除云层。

2. 预训练与微调
使用预训练模型作为起点，然后在您的去云任务上进行微调：

预训练模型：如果有可用的，您可以从一个在类似任务上预训练过的模型开始。例如，如果有在类似环境或条件下进行去云任务的预训练模型，您可以使用这些模型作为起点，这样模型就不是从零开始学习。

微调：在预训练模型的基础上，用您的去云数据集进行微调。在微调过程中，模型将会根据您的特定数据进一步调整其参数，从而学习去除云层。

3. 注意力机制
考虑在网络中引入注意力机制，使网络能够专注于图像中含云的区域。通过这种方式，网络可以更有效地学习如何处理这些区域，同时保持其他区域的原貌。

4. 迁移学习与领域适应
如果您的网络在一个领域（如无云图像）上已经有了很好的性能，但在另一个领域（如含云图像）上表现不佳，您可以考虑使用迁移学习或领域适应技术来调整网络，使其更好地泛化到新的领域。

总的来说，通过这些策略，您可以使网络在一开始就输出与原始含云图像相似的结果，并逐步学习去除云层，而不是完全从零开始生成去云图像。这些方法可以帮助网络更快地收敛，同时提高去云效果的自然性和真实性。
# 图像质量评估指标

## 1. PSNR (峰值信噪比 Peak Signal-to-Noise Ratio)

### 意义
PSNR是最常用的衡量图像重建或去噪质量的指标之一。它衡量的是原始图像与处理后图像之间的相似度。PSNR值越高，表明图像质量越好。

### 公式

$$
PSNR = 10 \cdot \log_{10} \left( \frac{MAX_I^2}{MSE} \right)
$$

其中， $MAX_I$是图像可能的最大像素值（对于8位图像， $MAX_I=255$）， $MSE$是均方误差，计算如下：

$$
MSE = \frac{1}{mn} \sum_{i=0}^{m-1} \sum_{j=0}^{n-1} \left[ I(i, j) - K(i, j) \right]^2
$$

 $I$是原始图像， $K$是处理后的图像， $m$和 $n$分别是图像的行数和列数。

## 2. SSIM (结构相似性指数 Structural Similarity Index)

### 意义
SSIM是一个更为先进的衡量图像质量的指标，与PSNR不同，SSIM考虑了图像的结构信息、亮度和对比度。SSIM值越接近1，表示图像质量越好。

### 公式

$$
SSIM(x, y) = \frac{(2\mu_x\mu_y + C_1)(2\sigma_{xy} + C_2)}{(\mu_x^2 + \mu_y^2 + C_1)(\sigma_x^2 + \sigma_y^2 + C_2)}
$$

其中， $\mu_x, \mu_y$是 $x, y$图像的平均亮度， $\sigma_x^2, \sigma_y^2$是图像的方差， $\sigma_{xy}$是 $x$和 $y$图像的协方差， $C_1$和 $C_2$是为了避免分母为零而添加的小常数。

## 3. MAE (平均绝对误差 Mean Absolute Error)

### 意义
MAE衡量的是原始图像与处理后图像之间的平均绝对差异。MAE值越低，说明图像质量越接近原始图像。

### 公式

$$
MAE = \frac{1}{mn} \sum_{i=0}^{m-1} \sum_{j=0}^{n-1} | I(i, j) - K(i, j) |
$$

## 4. SAM (光谱角映射器 Spectral Angle Mapper)

### 意义
SAM是遥感图像分析中常用的一个指标，它主要用于衡量两个光谱之间的相似度。SAM计算的是两个光谱向量之间的角度，角度越小，表示两个光谱越相似。

### 公式

$$
SAM = \cos^{-1} \left( \frac{\sum_{i=1}^{n} a_i b_i}{\sqrt{\sum_{i=1}^{n} a_i^2} \cdot \sqrt{\sum_{i=1}^{n} b_i^2}} \right)
$$

其中， $a_i$和 $b_i$分别是两个光谱向量在第 $i$个波段的反射率值。


原本的大数据模型在其对应的数据集上面的表现 PSNR SSIM MAE SAM 都有38.7171 0.9494 0.0087 3.3434 的数值。但是 当这个大数据预训练模型在我的小样本数据集的表现大概是-42.9476 0.0050 31.5633 136.4359  然后利用这个预训练模型在我的小样本数据集中进行训练后的预训练模型的话 表现大概是  -32.0286 0.1460 32.1914 6.7076。
1、请问这四个评估标准的数值范围大概是多少，像我这种出现负数的情况合理吗。 以及相似度居然只有0.0050会不会太夸张，因为当我把预测的图像进行展示的时候发现和真实图像还是有一些相似的，为什么会那么低。而且反而是，经过小样本数据集训练后的预测图象和真实图像看着不太相似反而有0.14的相似度。
2、请问，如果面对我现在这种情况，我应该怎么做，请详细一点，不是简单的说用迁移学习这样宽泛的方法。
1. 评估标准的数值范围及您的情况分析
PSNR (峰值信噪比)
范围：理论上，PSNR的值可以从0到无穷大，通常以分贝（dB）为单位。高PSNR值通常表示较高的图像质量。在实践中，PSNR值通常在20到40 dB之间，较高的值（例如40 dB以上）表明图像质量非常高。
您的情况：出现负数是不正常的，这可能表明计算中存在问题。PSNR计算中使用了对数函数，如果MSE非常小或接近0，可能导致负无穷大的结果；如果MSE大于MAX_I^2，则可能导致负值。请检查MSE的计算和MAX_I的值是否正确。
SSIM (结构相似性指数)
范围：SSIM的值范围从-1到1，其中1表示完全相同的两幅图像。一般来说，SSIM值高于0.5表示图像质量较好，接近1则表示非常相似。
您的情况：SSIM值为0.0050极低，这可能表明图像之间几乎没有相似性。这可能是因为图像之间存在很大的结构差异，或者计算方法存在问题。即使图像看起来有一定的相似性，SSIM的计算也可能因为图像细节上的巨大差异（如边缘、纹理等）而得出低值。
MAE (平均绝对误差)
范围：MAE的值范围从0到无穷大，0表示完美匹配，值越高表示误差越大。
您的情况：MAE值31.5633和32.1914相对较高，这表明预测图像与真实图像之间存在较大的像素级差异。这可能是因为模型在小样本数据集上过度拟合或未能捕获图像的关键特征。
SAM (光谱角映射器)
范围：SAM的值以度为单位，范围从0度到90度。0度表示完全相同的方向，即完全一致的光谱，而90度表示完全不同。
您的情况：原始模型在小样本数据集上的SAM值非常高，表明光谱角度差异巨大。训练后的模型虽然有所改善，但6.7076的值仍然表明存在一定的光谱差异。
2. 面对当前情况的建议
彻底检查数据：确保您的小样本数据集质量良好，没有标签错误或处理错误。数据预处理步骤（如归一化、裁剪等）是否与大样本数据集保持一致？

调整模型结构：考虑是否需要调整网络结构以更好地适应小样本数据集的特点。例如，减少模型复杂度以防止过拟合。

使用更先进的迁移学习技术：而不仅仅是直接应用预训练模型，可以尝试更复杂的迁移学习策略。例如，微调（Fine-tuning）中的层次化微调，冻结部分层而只训练模型的一部分；或者使用模型蒸馏（Model Distillation）技术，将大模型的知识转移到适合小样本的简化模型上。

数据增强：使用数据增强技术来人为增加小样本数据集的多样性，如旋转、翻转、缩放、颜色调整等。

引入正则化技术：考虑使用Dropout、L2正则化等技术减少过拟合。

检查损失函数和优化器：确保损失函数和优化器设置适合于任务和数据。有时调整学习率、损失函数的权重等也能带来显著改进。

可视化分析：使用梯度加权类激活映射（Grad-CAM）等技术可视化模型关注的区域，以确保模型正关注于图像中正确的特征。
