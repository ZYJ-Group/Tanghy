# 📁 项目文件结构详解

## 🎯 主入口文件

### main_TG.m
**作用：** 主程序入口，控制整体流程  
**功能：**
- 初始化路径和参数
- 调用地理计算、球面采样、目标参数设置
- 主循环：生成不同姿态（360-8100）的仿真图像
- 对每个姿态，使用四元数旋转目标，遍历6个观测时刻
- 计算LOS、相机参数，生成并保存图像与关键点标注

---

## 📂 subfunctions/ - 核心子函数目录

### GeoCal.m
**作用：** 地理坐标计算  
**功能：**
- 加载轨道数据（TLE/RAE.mat）
- 设置观测站位置（纬度35.9°，经度116.4°）
- 将目标轨道数据转换为ECEF
- 可视化目标轨道与观测站位置

### param_target.m
**作用：** 目标模型参数设置  
**功能：**
- 加载ISAR模型（.mat）和光学模型（.obj）
- 设置分辨率：ISAR 0.08m，光学 0.3m
- 定义6个关键点坐标
- 对模型进行坐标变换与缩放

### sphere_homeo.m
**作用：** 球面采样初始化  
**功能：**
- 调用sphere_homeo_sfc_isotropic_splg.m进行各向同性球面采样

### sphere_homeo_sfc_isotropic_splg.m
**作用：** 球面同胚表面的各向同性采样  
**功能：**
- 按球坐标参数化采样
- 生成采样点网格与三角剖分
- 支持均匀/随机采样

### LOSCalculation_motion.m
**作用：** 视线方向计算（运动目标）  
**功能：**
- 基于ECEF计算目标与观测站LOS
- 动态扩展时间窗口，确保有效转角≥阈值
- 将LOS投影到目标本体坐标系（RVN）
- 计算垂直轴与水平轴

### LOSCalculation.m
**作用：** 视线方向计算（静态版本）  
**功能：**
- 与LOSCalculation_motion.m类似，用于ISAR成像

### Rot2angle.m
**作用：** 角度旋转矩阵计算  
**功能：**
- 根据方位角与俯仰角生成旋转矩阵

### isar_save.m
**作用：** ISAR图像保存（已注释，未使用）  
**功能：**
- 保存ISAR图像与关键点标注

### linean.m
**作用：** 线性对齐/相位补偿  
**功能：**
- 用于ISAR的距离对齐与相位补偿

---

## 📂 subfunc_imagesimu/ - 图像仿真子函数目录

### image_generate.m
**作用：** 光学图像生成核心函数  
**功能：**
- 调用buildtree2（MEX）进行射线-三角面片求交
- 计算一次散射与二次散射能量（Lambert）
- 后处理：添加噪声、相位、FFT、加窗

### CameraandRay.m
**作用：** 相机参数计算  
**功能：**
- 为128×128像素计算相机位置与视线方向
- 按像素间距排列生成相机网格

### rot.m
**作用：** 绕任意轴旋转矩阵  
**功能：**
- 根据轴向量与角度生成3×3旋转矩阵

### cal_insec.m
**作用：** 射线-三角面片求交（MATLAB版）  
**功能：**
- 使用Möller-Trumbore方法计算交点，返回最短路径时间

### cal_insec.cpp / cal_insec.mexw64
**作用：** 射线求交的C++实现与编译版本  
**功能：**
- 加速求交计算

### buildtree2.mexw64
**作用：** 射线求交的编译加速库  
**功能：**
- 使用空间结构（如KD-tree/BVH）加速批量射线求交

### GeoCalculation.m
**作用：** SAR几何计算  
**功能：**
- 基于目标轨道建立SAR坐标系，计算速度方向与坐标系轴

### ECEF_cal_SatTar.m
**作用：** 基于TLE计算卫星ECEF坐标  
**功能：**
- 使用SGP4模型传播轨道
- 转换为ECEF，计算可见弧段
- 生成RAE数据并保存

### OTV_SARImagery_Simu.m
**作用：** SAR图像仿真（未在主流程使用）  
**功能：**
- 类似光学仿真，但用于SAR成像

### Simu_Main_gai.m
**作用：** SAR仿真主函数（未在主流程使用）  
**功能：**
- 包含完整的SAR仿真流程

### Predata_Dispaly.m
**作用：** OBJ转MAT预处理器  
**功能：**
- 读取OBJ，转换为三角面片矩阵并保存为.mat

### SAR_Geometry_Cal.m
**作用：** SAR几何参数计算  
**功能：**
- 建立SAR坐标系，计算中心、速度方向、坐标轴

### taywin.m
**作用：** Taylor窗函数生成  
**功能：**
- 生成用于SAR处理的Taylor窗

---

## 📂 data/ - 数据目录

### datai_f.dat / datar_f.dat
**作用：** 数据文件（具体用途需结合代码判断）

---

## 📂 target/ - 目标模型目录

### TG1.obj
**作用：** 光学仿真用3D模型（Wavefront OBJ）

### TG1.obj.mat
**作用：** OBJ转换后的三角面片数据（预计算）

### TG1_sat_point.mat
**作用：** ISAR点云数据

### TG1_sat_face.mat
**作用：** ISAR面片索引数据

---

## 📂 TLE/ - 轨道数据目录

### TLE.txt
**作用：** 两行元素格式轨道数据  
**内容：**
- 卫星NORAD ID: 37820
- 观测站位置（纬度46.648°，经度130.307°）

### RAE.mat
**作用：** 处理后的轨道数据（MATLAB格式）  
**内容：**
- 包含距离(R)、方位角(A)、俯仰角(E)、时间(T)、LLH坐标等

---

## 📂 img_tg/ - 输出图像目录

### op_0.3/
**作用：** 保存生成的光学图像  
**文件：**
- `.bmp`：128×128灰度图像
- `b2.txt`：关键点标注（图像路径、类别、坐标）

# 🔄 代码执行流程总结

    main_TG.m
    ├─ GeoCal.m (加载轨道数据)
    ├─ sphere_homeo.m (初始化采样)
    ├─ param_target.m (加载3D模型)
    └─ 主循环 (num = 360:100:8100)
         ├─ 计算旋转姿态 (四元数)
         └─ 对每个观测时刻
              ├─ 旋转目标模型
              ├─ LOSCalculation_motion.m (计算LOS)
              ├─ CameraandRay.m (计算相机参数)
              ├─ image_generate.m (生成图像)
              └─ 保存图像和标注

---

# 🎯 核心算法

- **射线追踪：** buildtree2 加速求交  
- **散射模型：** Lambert模型，一次/二次散射  
- **坐标系变换：** ECEF → 目标本体（RVN）→ 相机坐标系  
- **四元数旋转：** 用于姿态变换  

---

# 📌 系统用途说明

整个系统用于生成卫星目标在不同姿态下的仿真光学图像数据集，适用于深度学习训练。
