# 去云实验要求  
## 翻译  
（索总论文）  
### 4.1 实验   
**设置详细信息**  
所提出的框架是使用可公开访问的 PyTorch 框架开发的。训练迭代的最大纪元设置为 50 以达到收敛。初始学习率设置为 10−4，每 25 个 epoch 衰减 0.1。为了提高计算效率，所有实验均在GPU并利用双核并行网络。我们使用 Adam 优化器优化网络参数 (Dozat, 2016)。  

**数据集**  
所有实验均使用 SEN12MSCR（Ebel 等人，2020a）数据集进行，该数据集是第一个公开的遥感除云大规模数据集。它由对应季节的四个子数据集组成：春季、夏季、秋季和冬季。以spring子数据集为例，数据集中的每幅图像尺寸为256×256，由相应的2波段SAR图像、13波段无云光学图像和受云影响的光学图像组成。为了提高模型训练的效率，我们从 spring 数据集中选择了 42 个感兴趣区域（ROI）。为了清楚地观察去云效果，我们选择了两个不同级别云量分布相对均匀的ROI作为测试集。其余 40 个 ROI 用作训练集，另外两个 ROI 指定为验证集。训练集包含 25,521 张图像，验证集包含 1,244 张图像，测试集包含 1,453 张图像。在训练、验证和测试阶段，图像全部调整为 128x128 像素。此外，遵循Xu等人，2022年的数据处理方法，我们将SAR图像的第一通道数据裁剪为[-25, 0]，第二通道数据裁剪为[-32.5, 0]，最后将它们缩放为[ 0, 1]。对于无云光学图像和阴天图像，我们仅选择 RGB 通道，将其裁剪为 [0, 10000]，并将其归一化为 [0, 1]。这种数据处理方法用于本文提出的所有实验。

**指标**  
使用四个广泛使用的指标来评估云去除的性能：峰值信噪比 (PSNR)、SSIM、平均绝对误差 (MAE) 和光谱角映射器 (SAM)。PSNR 测量信号的最大可能功率与影响信号的噪声功率之间的比率，以分贝 (dB) 表示。PSNR 值越高，表示重建图像与原始图像之间的相似度越高，意味着图像质量越好，失真或噪声越少。MAE 量化重建图像和地面真实图像之间的平均像素差异。它通过考虑绝对差异而不考虑误差方向来衡量重建的总体精度。MAE 值越低，平均误差越小。PSNR、SSIM和MAE用于评估空间结构恢复，而SAM则表示恢复结果中光谱信息的保存程度。

对于具有像素值 xi 和 yi 的预测图像 X 和真实图像 Y，度量计算如下：  
![image](https://github.com/ZYJ-Group/Tanghy/assets/94824386/871062d6-8a97-4927-9772-364c09e71135)  

其中n表示像素总数，MSE表示均方误差。SAM 将每个像素的光谱视为高维向量，并通过计算两个向量之间的角度来测量光谱相似度。角度越小，光谱越相似。  
![image](https://github.com/ZYJ-Group/Tanghy/assets/94824386/9e33aaff-778a-45b1-9760-19c9c9a3fb86)  

比较基线。在本文中，我们将我们提出的方法与几种典型的云去除算法进行比较：
- McGAN（Mroueh et al., 2017）：一种使用SAR和光学图像的联合数据作为输入并使用U-Net作为生成器从多云图像恢复无云图像的方法。
- SpA GAN（Emami 等人，2020）：一种采用空间注意力网络（SPANet）的方法 Wang 等人。 （2019）作为生成器，仅使用多云图像作为输入，不包含辅助 SAR 图像。
- DSen2-CR（Meraner 等人，2020）：基于超分辨率 Deep Sentinel-2（DSen-2）ResNet（Lanaras 等人（2018））修改的残差结构，它采用级联 SAR 和光学图像作为输入。
- GLF-CR（Xu 等人，2022）：尝试使用双流网络分别从 SAR 和光学图像中提取特征的方法。它堆叠了多个本地模块，用于两种模态之间的信息交互，这显着提高了图像恢复的有效性。
- Uformer（Han 等人，2023）：基于 U 形 Transformer 的网络改编自 Uformer 网络（Wang 等人，2022），该网络也将 SAR 和光学图像的串联数据作为输入。

### 4.2.云去除比较  
为了严格评估我们提出的方法的泛化能力，我们对所有基线技术进行了域内和域外实验。域内评估侧重于分析类似于训练数据集的条件下的去除性能。相比之下，域外测试评估了删除过程对未见数据的有效性，特别是在夏季、秋季和冬季等不同季节。  
**域内测试**   
为了评估不同去云算法的能力，我们选择了云和云影覆盖范围为0-10%、10%20%、20%-40%、40%-60%、60%-80%的六种场景，和80%-100%。图 5 展示了各种去云算法的可视化结果。如图 5 所示，我们的方法比其他方法实现了更高的图像保真度，这意味着生成的图像与地面实况的颜色分布紧密匹配。 McGAN 和 GLF-CR 的色彩保真度受到影响。这种缺陷可能是由于模型无法准确捕获输入和输出图像之间的颜色映射关系，导致结果的视觉质量显着下降。此外，与替代网络相比，我们的方法展示了卓越的图像恢复能力，在厚云和薄云条件下都保留了复杂的细节。 McGAN 和 SpA GAN 都使用类似的生成器架构。然而，由于 SAR 提供了额外的纹理信息，McGAN 在纹理恢复方面超越了 SpAGAN。然而，当云覆盖率超过20%时，McGAN也失去了除云能力。 DSen2-CR 在去除云和云阴影方面表现出有限的能力，因为在生成的图像中不良伪影仍然很明显。具体来说，在遮挡视线的厚厚云层下，生成的图像只能保留最少的有用信息。对于GLF-CR，尽管其图像保真度较低导致图像质量较低，但仍然可以观察到其恢复图像细节的能力，如下所示，在第四行的场景中。 Uformer 擅长捕获对图像恢复至关重要的本地和全局依赖性，从而显着提高云去除效率。虽然它能够熟练地管理薄云而不留下可见的痕迹，但当面对被浓密云层覆盖的区域时，它的熟练程度就会下降。在无云区域的信息保存方面，我们的方法始终优于其他方法。 McGAN 和 SpA GAN 倾向于在这些区域保留模糊的纹理，而 DSen2-CR 则以其在保持清晰度方面无可挑剔的表现而脱颖而出。这一成功可以归功于其独特的残差结构和云自适应正则化损失函数。同样，Uformer 在保护无云区域中的数据完整性方面也表现出色。为了检验网络在复杂场景下恢复细节的能力，我们选择不同的复杂度构建覆盖场景（如图6所示）。我们可以观察到，即使在有雾或薄/厚云的情况下，我们提出的方法也能在复杂建筑物的细节方面表现出良好的图像恢复能力。 SpA GAN 在保留复杂场景中的细节方面遇到困难，这很大程度上归因于缺乏 SAR 信息。相比之下，McGAN、DSen2-CR和Uformer使用直接结合SAR和光学图像通道的融合方法，由于多模态数据的异构性，会产生模糊且不太详细的图像。虽然 GLF-CR 偶尔会产生模糊的图像，但它明显保留了大量的边缘细节。表 1 显示了从 spring 数据集中获得的定量结果。这些指标结果与我们之前的视觉分析非常吻合。具体来说，McGAN、SpA GAN 和 GLF-CR 显示 SAM 值升高，表明存在明显的光谱漂移和颜色异常。 McGAN 和 SpA GAN 生成的图像都与真实数据存在明显偏差，导致相似度降低。同时，DSen2-CR 表现出卓越的数据保留能力在没有云的地区，获得了值得称赞的定量分数。然而，由于 GLF-CR 和 Uformer 在重建被浓云破坏的图像方面的能力受到限制，与我们提出的技术相比，它们记录了更高的 MAE 和减少的 SSIM。 

**域外测试**  
必须强调的是，这些数据集中云量分布的差异可能会导致结果的变化。例如，冬季数据集可能会显示更多的无云图像。如表 2 所示，SSIM 和 PSNR 值升高，加上 MAE 和 SAM 指标降低，强调了所提出模型的卓越鲁棒性和通用性。  

### 4.3.以评估所提出的 MPIR 策略
类似地，我们进行了域内和域外实验，以评估所提出的 MPIR 策略与独立 DSFFnet 相比的有效性。  

**域内测试**  
图 7 展示了 MPIR 变体与独立 DSFFnet 的直观比较。我们可以观察到所有 MPIR 变体都超过了 DSFFnet 基线的性能。红色框强调了选择进行详细比较的特定区域。我们选择一系列具有不同云层强度的地形来研究渐进算法在保留原始区域和维护边缘细节方面的熟练程度。仔细检查表明，所有四种算法在云去除方面都产生了值得称赞的结果，并且没有引入可辨别的伪影。评估颜色保真度时，MPIR1、MPIR2 和 MPIR4 显示与原始图像紧密一致的颜色分布。相反，MPIR3 在此指标上落后。在边缘保留方面，MPIR1、MPIR2 和 MPIR4 比 DSFFnet 具有明显的优势。此外，我们注意到 MPIR1 的云去除效果在云层密集的区域显着减弱，导致伪阴影挥之不去，在第四行的红色区域尤其明显。云覆盖区域的恢复粒度也有改进的空间。相反，在无云区域，MPIR2 在保留固有数据方面始终优于 DSFFnet。这种出色的保存很大程度上归功于 MPIR2 结束阶段的精心设计的架构，该架构是专门为高保真分辨率维护而设计的。尽管如此，就恢复被云遮蔽的区域而言，虽然全球陆地轮廓已明显重建，但其中复杂的砖石图案仍然有些模糊。


## 采集数据要求

| 项目      | 描述          |
|----------|--------------|
| 季节      | 春季          |
| 图像类型   | SAR + RGB     |
| 像素值    | 256 * 256    |
| 通道数    | VV+VH, RGB    |

